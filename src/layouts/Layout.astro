---
import { Image } from 'astro:assets';
import { getCollection } from 'astro:content';
import logo from '../assets/logo.png';
import TableOfContents from '../components/TableOfContents.astro';

interface Props {
	title: string;
    headings?: { depth: number; slug: string; text: string; }[];
}

const { title, headings } = Astro.props;

const allArticles = await getCollection('articles');
// Sort by date desc
const sortedArticles = allArticles.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
const recentArticles = sortedArticles.slice(0, 5);
---

<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="shortcut icon" type="image/x-icon" href="/resource/favicon/favicon.ico">
		<meta name="description"
			content="ソフトウェアと文字が好きな大学生、Ulibooooのポートフォリオサイトです。Rustで開発したCLIツールや、技術記事（Zenn/note）の情報をまとめています。">
		<meta property="og:title" content="about uliboooo" />
		<meta property="og:description" content="describe about uliboooo" />
		<meta property="og:image" content="https://about.uliboooo.dev/resource/logo.png" />
		<meta property="og:url" content="https://about.uliboooo.dev/" />
		<meta property="og:type" content="website" />
		<meta property="og:site_name" content="about uliboooo" />

		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:image" content="https://about.uliboooo.dev/resource/logo.png" />
		<meta name="generator" content={Astro.generator} />
		<title>{title}</title>
	</head>
	<body>
        <div class="container">
            <header class="site-header">
                <div class="header-main">
                    <div class="logo">
                        <a href="/">
                            <Image src={logo} alt="Logo" height={50} />
                        </a>
                    </div>
                    <div class="info">
                        <a href="https://about.uliboooo.dev/" target="_blank" class="external-link">About Me</a>
                        <a href="https://github.com/Uliboooo" target="_blank" class="external-link">GitHub</a>
                        <a href="https://x.com/Uliboooo" target="_blank" class="external-link">X</a>
                    </div>
                </div>
                <nav class="menu">
                    <a href="/">All Articles</a>
                    <a href="/tags">List by Tag</a>
                </nav>
            </header>
            <main>
                <div class="content">
                    <slot />
                </div>
                <aside class="sidebar">
                    {headings && headings.length > 0 && (
                        <nav class="toc sidebar-toc">
                            <h3>Table of Contents</h3>
                            <TableOfContents headings={headings} />
                        </nav>
                    )}
                    <div class="previous-articles">
                        <h3>Previous Articles</h3>
                        <ul>
                            {recentArticles.map(article => (
                                <li><a href={`/articles/${article.slug}`}>{article.data.title}</a></li>
                            ))}
                        </ul>
                    </div>
                </aside>
            </main>
            <footer>
                <p>&copy; 2026 Uliboooo. All rights reserved.</p>
                <a href="https://github.com/Uliboooo/blog" class="external-link">View Source</a>
            </footer>
        </div>
	</body>
</html>

<style is:global>
    :root {
        --font-serif: "Times New Roman", "Yu Mincho", "Hiragino Mincho ProN", "Hiragino Sans Serif Interface", "Noto Serif JP", "MS Mincho", "IPAmjMincho", serif;
        --font-sans: "Helvetica Neue", "Hiragino Kaku Gothic ProN", "Hiragino Sans", "Noto Sans JP", Arial, Meiryo, sans-serif;
        --font-mono: Menlo, Monaco, Lucida Console, "Liberation Mono", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Courier New", monospace;
        --bg-color: #fcfcfc;
    }
    
    html {
        background-color: var(--bg-color);
        font-family: var(--font-sans);
    }
    
    body {
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        min-height: 100vh;
    }

    .container {
        width: 80%;
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem 0;
        display: flex;
        flex-direction: column;
        gap: 2rem;
    }

    .logo, .menu, .info {
        white-space: nowrap;
    }

    .site-header {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid #ccc;
        font-family: var(--font-serif);
    }

    .header-main {
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
        flex-wrap: wrap;
        gap: 1rem;
    }

    .menu {
        display: flex;
        gap: 2rem;
        justify-content: center;
        width: 100%;
    }

    .info {
        display: flex;
        gap: 1rem;
        font-size: 0.9rem;
    }

    main {
        display: flex;
        gap: 2rem;
        flex: 1;
        flex-direction: row; /* Ensure row for 8:2 split */
    }

    .content {
        flex: 8;
        min-width: 0; 
        overflow-wrap: break-word;
    }

    .sidebar {
        flex: 2;
        border-left: 1px solid #eee;
        padding-left: 1rem;
        /* Sticky positioning for desktop */
        position: sticky;
        top: 2rem;
        align-self: flex-start;
        max-height: calc(100vh - 4rem); /* Prevent sidebar from being taller than viewport if possible, or just let it scroll naturally if content is long. But sticky needs space. */
        overflow-y: auto; /* Allow scrolling within sidebar if it's too tall */
    }
    .sidebar h3 {
        margin-top: 0;
        margin-bottom: 1rem;
        font-size: 1.2rem;
    }
    .sidebar ul {
        padding-left: 1.2rem;
        list-style: none;
        margin: 0;
    }
    .sidebar li {
        margin-bottom: 0.5rem;
    }
    
    /* TOC Styles */
    .toc {
        margin-bottom: 2rem;
        padding-bottom: 2rem;
        border-bottom: 1px solid #eee;
    }

    footer {
        margin-top: auto;
        padding-top: 1rem;
        border-top: 1px solid #ccc;
        display: flex;
        justify-content: space-between;
        font-size: 0.8rem;
        color: #666;
    }

    h1, h2, h3, h4, h5, h6 {
        font-family: var(--font-serif);
        overflow-wrap: break-word;
    }

    p, li {
        overflow-wrap: break-word;
    }

    a {
        color: inherit;
        text-decoration: none;
    }
    a:hover {
        text-decoration: underline;
    }
    
    /* External link indicator with SVG and Animation */
    .external-link {
        display: inline-flex;
        align-items: center;
        gap: 0.1em; /* Slight gap between text and icon */
    }
    
    .external-link::after {
        content: "";
        display: inline-block;
        width: 1em;
        height: 1em;
        background-color: currentColor; /* Inherit text color */
        
        /* Arrow Up Right SVG with stroke-width 1.5 for Thin font match */
        -webkit-mask-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><line x1="7" y1="17" x2="17" y2="7"></line><polyline points="7 7 17 7 17 17"></polyline></svg>');
        mask-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><line x1="7" y1="17" x2="17" y2="7"></line><polyline points="7 7 17 7 17 17"></polyline></svg>');
        
        -webkit-mask-repeat: no-repeat;
        mask-repeat: no-repeat;
        -webkit-mask-position: center;
        mask-position: center;
        
        transition: transform 0.2s ease;
    }

    .external-link:hover::after {
        transform: translate(2px, -2px); /* Move top-right on hover */
    }

    @media (max-width: 768px) {
        .container {
            width: 95%;
        }

        main {
            flex-direction: column;
        }

        .sidebar {
            border-left: none;
            padding-left: 0;
            border-top: 1px solid #eee;
            padding-top: 2rem;
            position: static; /* Reset sticky on mobile */
            align-self: auto;
            max-height: none;
        }
        
        .sidebar-toc {
            display: none;
        }
    }
</style>
